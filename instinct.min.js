(function(){function e(e){var t=n.exec(""+e.prototype.constructor),r={};return t[1].length>0&&t[1].replace(/\s/g,"").split(",").forEach(function(e,t){r[e]=t}),r}function t(e,t){return new r(e,t)}function r(e,t){this.logic=e||{},this.facts=t||{},this.process={}}function c(){}"undefined"==typeof module?self.instinct=t:module.exports=t,t.version="0.0.6";var n=/function.*?\((.*?)\).*/;r.prototype.exec=function(t,r){function n(e){if(e&&(a=-1,o.process[t].apply(o,arguments)),!a--){var r=[];for(var c in i)r[i[c]]=u[c]?u[c]:o.facts[c];s.apply(u,r)}}var s,o=this;if("function"!=typeof t){if(o.facts[t])return r(null,o.facts[t]);var f=this.process[t];if(f)return o.process[t]=function(){f.apply(o,arguments),r&&r.apply(o,arguments)},o;if(s=o.logic[t],"function"!=typeof s)return void 0!==s?r(null,o.facts[t]=s):r({ref:t,err:"Not defined"})}else s=t;var i=e(s),a=0;o.process[t]=function(e,c){delete o.process[t],e||(o.facts[t]=c),e&&!e.ref&&(e={ref:t,err:e}),r&&r.call(o,e,c)};var u={callback:function(){this.callback=c,o.process[t].apply(o,arguments)},success:function(e){this.callback(null,e)},error:function(e){this.callback(e)},facts:o.facts};return u.resolve=u.success,u.reject=u.error,Object.keys(i).forEach(function(e){void 0!==o.facts[e]||e in u||(a++,o.exec(e,n))}),n(),o},r.prototype.as=function(e){return this.process[e]=c,function(t,r){t||(self.facts[ref]=r),t&&!t.ref&&(t={ref:ref,err:t}),process[e](t,r),delete process[e]}}})();