(function(){function e(e){var t=n.exec(""+e.prototype.constructor),r={};return t[1].length>0&&t[1].replace(/\s/g,"").split(",").forEach(function(e,t){r[e]=t}),r}function t(e,t){return new r(e,t)}function r(e,t){this.logic=e||{},this.facts=t||{},this.process={}}function c(){}"undefined"==typeof module?self.instinct=t:module.exports=t,t.version="0.0.6";var n=/function.*?\((.*?)\).*/;r.prototype.exec=function(t,r){function n(e){if(e&&(i=-1,o.process[t].apply(o,arguments)),!i--){var r=[];for(var c in a)r[a[c]]=l[c]?l[c]:o.facts[c];s.apply(l,r)}}var s,o=this;if("function"!=typeof t){if(o.facts[t])return r(null,o.facts[t]);var f=this.process[t];if(f)return o.process[t]=function(){f.apply(o,arguments),r&&r.apply(o,arguments)},o;if(s=o.logic[t],"function"!=typeof s)return void 0!==s?r(null,o.facts[t]=s):r({ref:t,err:"Not defined"})}else s=t;var a=e(s),i=0;o.process[t]=function(e,c){delete o.process[t],e||(o.facts[t]=c),e&&!e.ref&&(e={ref:t,err:e}),r&&r.call(o,e,c)};var l={};l.callback=function(){l.callback=c,o.process[t].apply(o,arguments)},l.facts=l.all=o.facts,l.success=l.resolve=function(e){l.callback(null,e)},l.error=l.reject=function(e){l.callback(e,null)};var u=a.all>-1?Object.keys(o.logic):Object.keys(a);return u.forEach(function(e){void 0!==o.facts[e]||e in l||(i++,o.exec(e,n))}),n(),o},r.prototype.as=function(e){return this.process[e]=c,function(t,r){t||(self.facts[ref]=r),t&&!t.ref&&(t={ref:ref,err:t}),process[e](t,r),delete process[e]}}})();