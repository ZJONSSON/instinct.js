/**
  * instinct.js (c) 2009-2013 Ziggy.jonsson.nyc@gmail.com
  * @license MIT
  */
(function(){function e(e){var t=r.exec(""+e.prototype.constructor),c={};return t[1].length>0&&t[1].replace(/\s/g,"").split(",").forEach(function(e,t){c[e]=t}),c}function t(e,t){return new c(e,t)}function c(e,t){this.logic=e||{},this.facts=t||{},this.process={},this.children={}}function n(){}"undefined"==typeof module?self.instinct=t:module.exports=t,t.version="0.0.7";var r=/function.*?\((.*?)\).*/;c.prototype.set=function(e,t){var c=this;c.facts[e]=t,c.children[e]&&Object.keys(c.children[e]).forEach(function(e){void 0!==c.facts[e]&&c.set(e,void 0)})},c.prototype.exec=function(t,c){function r(e){if(e&&(a=-1,s.process[t].apply(s,arguments)),!a--){var c=[];for(var n in f)c[f[n]]=l[n]?l[n]:s.facts[n];o.apply(l,c)}}var o,s=this;if("function"!=typeof t){if(s.facts[t])return c(null,s.facts[t]);var i=this.process[t];if(i)return s.process[t]=function(){i.apply(s,arguments),c&&c.apply(s,arguments)},s;if(o=s.logic[t],"function"!=typeof o)return void 0!==o?c(null,o):c({ref:t,err:"Not defined"})}else o=t;var f=e(o),a=0;s.process[t]=function(e,n){delete s.process[t],e||(s.facts[t]=n),e&&!e.ref&&(e={ref:t,err:e}),c&&c.call(s,e,n)};var l={};l.callback=function(){l.callback=n,s.process[t]&&s.process[t].apply(s,arguments)},l.facts=l.all=s.facts,l.success=l.resolve=function(e){l.callback(null,e)},l.error=l.reject=function(e){l.callback(e,null)};var u=f.all>-1?Object.keys(s.logic):Object.keys(f);return u.forEach(function(e){void 0!==s.facts[e]||e in l||(a++,"function"!=typeof t&&((s.children[e]||(s.children[e]={}))[t]=!0),s.exec(e,r))}),r(),s},c.prototype.as=function(e){var t=this;return t.process[e]=n,function(c,n){c||(t.facts[e]=n),c&&!c.ref&&(c={ref:e,err:c}),t.process[e](c,n),delete t.process[e]}}})();