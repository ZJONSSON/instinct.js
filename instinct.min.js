(function(){function e(e){var t=r.exec(""+e.prototype.constructor),c={};return t[1].length>0&&t[1].replace(/\s/g,"").split(",").forEach(function(e,t){c[e]=t}),c}function t(e,t){return new c(e,t)}function c(e,t){this.logic=e||{},this.facts=t||{},this.process={},this.children={}}function n(){}"undefined"==typeof module?self.instinct=t:module.exports=t,t.version="0.0.6";var r=/function.*?\((.*?)\).*/;c.prototype.set=function(e,t){var c=this;c.facts[e]=t,c.children[e]&&Object.keys(c.children[e]).forEach(function(e){void 0!==c.facts[e]&&c.set(e,void 0)})},c.prototype.exec=function(t,c){function r(e){if(e&&(a=-1,s.process[t].apply(s,arguments)),!a--){var c=[];for(var n in i)c[i[n]]=l[n]?l[n]:s.facts[n];o.apply(l,c)}}var o,s=this;if("function"!=typeof t){if(s.facts[t])return c(null,s.facts[t]);var f=this.process[t];if(f)return s.process[t]=function(){f.apply(s,arguments),c&&c.apply(s,arguments)},s;if(o=s.logic[t],"function"!=typeof o)return void 0!==o?c(null,s.facts[t]=o):c({ref:t,err:"Not defined"})}else o=t;var i=e(o),a=0;s.process[t]=function(e,n){delete s.process[t],e||(s.facts[t]=n),e&&!e.ref&&(e={ref:t,err:e}),c&&c.call(s,e,n)};var l={};l.callback=function(){l.callback=n,s.process[t].apply(s,arguments)},l.facts=l.all=s.facts,l.success=l.resolve=function(e){l.callback(null,e)},l.error=l.reject=function(e){l.callback(e,null)};var u=i.all>-1?Object.keys(s.logic):Object.keys(i);return u.forEach(function(e){void 0!==s.facts[e]||e in l||(a++,"function"!=typeof t&&((s.children[e]||(s.children[e]={}))[t]=!0),s.exec(e,r))}),r(),s},c.prototype.as=function(e){return this.process[e]=n,function(t,c){t||(self.facts[ref]=c),t&&!t.ref&&(t={ref:ref,err:t}),process[e](t,c),delete process[e]}}})();