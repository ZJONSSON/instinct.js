(function(){function t(t){var e=c.exec(""+t.prototype.constructor),n={};return e[1].length>0&&e[1].replace(/\s/g,"").split(",").forEach(function(t,e){n[t]=e}),n}function e(t,e){return new n(t,e)}function n(t,e){this.logic=t||{},this.facts=e||{},this.process={}}function r(){}"undefined"==typeof module?self.instinct=e:module.exports=e,e.version="0.0.6";var c=/function.*?\((.*?)\).*/;n.prototype.exec=function(e,n){function c(t){if(t&&(a=-1,o.process[e].apply(o,arguments)),!a--){var n=[];for(var r in i)n[i[r]]=u[r]?u[r]:o.facts[r];s.apply(u,n)}}var s,o=this;if("function"!=typeof e){if(o.facts[e])return n(null,o.facts[e]);var f=this.process[e];if(f)return o.process[e]=function(){f.apply(o,arguments),n&&n.apply(o,arguments)},o;if(s=o.logic[e],"function"!=typeof s)return void 0!==s?n(null,o.facts[e]=s):n({ref:e,err:"Not defined"})}else s=e;var i=t(s),a=0;o.process[e]=function(t,r){delete o.process[e],t||(o.facts[e]=r),t&&!t.ref&&(t={ref:e,err:t}),n&&n.call(o,t,r)};var u={callback:function(){this.callback=r,o.process[e].apply(o,arguments)},fact:function(t){this.callback(null,t)},error:function(t){this.callback(t)},facts:o.facts};return Object.keys(i).forEach(function(t){void 0!==o.facts[t]||t in u||(a++,o.exec(t,c))}),c(),o},n.prototype.as=function(t){return this.process[t]=r,function(e,n){e||(self.facts[ref]=n),e&&!e.ref&&(e={ref:ref,err:e}),process[t](e,n),delete process[t]}}})();